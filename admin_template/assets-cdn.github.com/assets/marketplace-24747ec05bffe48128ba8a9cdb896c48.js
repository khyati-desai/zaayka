define("github-rollup-marketplace",["github/query-selector","delegated-events","github/jquery","@github/sortablejs","github/typecast","github/fetch","github/text","invariant","selector-observer","github/onfocus","github/form","github/pjax"],function(e,t,n,r,a,s,l,i,o,c,u,d){"use strict";function m(t){return e.querySelectorAll(t,"input:checked",HTMLInputElement).map(function(e){return e.value}).filter(function(e){return e.length>0})}function p(t){var n=e.closest(t,".js-marketplace-listing-form-container");e.query(n,".js-marketplace-listing-error-container").classList.remove("visible")}function g(t,n){var r=e.closest(t,".js-marketplace-listing-form-container"),a=e.query(r,".js-marketplace-listing-error-container");a.classList.add("visible"),e.query(a,".js-marketplace-listing-error").textContent=n}function f(e){var t=e.querySelector(".js-marketplace-listing-save-notice");t&&(t.classList.add("visible"),setTimeout(function(){return t.classList.remove("visible")},1500))}function h(t,n){var r=e.closest(t,".js-marketplace-listing-form-container").querySelectorAll(".js-marketplace-listing-bgcolor"),a=!0,s=!1,l=void 0;try{for(var i,o=r[Symbol.iterator]();!(a=(i=o.next()).done);a=!0){i.value.style.backgroundColor="#"+n}}catch(e){s=!0,l=e}finally{try{!a&&o.return&&o.return()}finally{if(s)throw l}}}function v(e){var t=document.querySelector(".js-hero-listing-container .js-hero-listing-bgcolor");t&&(t.style.backgroundColor="#"+e)}function j(t,n,r){i(r instanceof HTMLElement,"null.js:102");var a=e.closest(r,".js-listing-characters-remaining-container"),s=e.query(a,".js-listing-characters-remaining"),o=String(s.getAttribute("data-suffix")),c=n-l.getUtf8StringLength(t);s.textContent=c+" "+o,s.classList.toggle("text-red",c<=5)}function y(e){var t=e.item;t.setAttribute("data-old-index",e.oldIndex);var n=t.querySelector(".js-marketplace-listing-screenshot-resequence-form"),r=n.elements.namedItem("marketplace_listing_screenshot[previousScreenshotId]"),a=t.previousElementSibling;r.value=a?a.getAttribute("data-screenshot-id"):"",u.submit(n)}n=n&&n.hasOwnProperty("default")?n.default:n,r=r&&r.hasOwnProperty("default")?r.default:r,a=a&&a.hasOwnProperty("default")?a.default:a,i=i&&i.hasOwnProperty("default")?i.default:i,d=d&&d.hasOwnProperty("default")?d.default:d,t.on("selectmenu:selected",".js-languages-select-menu",function(t){var n=t.currentTarget;!function(t,n){var r=e.query(t,".js-preview-supported-languages-container"),a=e.query(t,".js-no-supported-languages-container"),s=n.length>0;a.classList.toggle("d-none",s),r.classList.toggle("d-none",!s),r.textContent=n.join(", ")}(n,m(n))}),c.onInput(".js-marketplace-short-description-field",function(t){var n=a(t.target,HTMLInputElement),r=e.closest(n,".form-group");n.validity.patternMismatch?r.classList.add("errored"):r.classList.remove("errored")}),t.on("click",".js-marketplace-error-dismiss",function(){p(this)}),t.on("change",".js-marketplace-listing-light-text",function(e){var t,n,r=a(e.target,HTMLSelectElement);t=r.value,(n=document.querySelector(".js-hero-listing-name"))&&("true"===t?(n.classList.add("text-white"),n.classList.remove("text-gray-dark")):(n.classList.remove("text-white"),n.classList.add("text-gray-dark")))}),t.on("change",".js-marketplace-listing-logo-background-color",function(t){var n=a(t.target,HTMLInputElement);h(e.closest(t.target,"form",HTMLFormElement),n.value),v(n.value)}),n(document).on("ajaxSend",".js-marketplace-listing-form",function(){p(this)}),n(document).on("ajaxSuccess",".js-marketplace-listing-form",function(e,t,n,r){if(r){if(r.path){var a=window.location.pathname,s=r.path;if(a!==s)return void(window.location.href=s)}r.bgcolor&&(h(this,r.bgcolor),v(r.bgcolor)),r.short_description&&(l=r.short_description,(i=document.querySelector(".js-hero-listing-description"))&&(i.textContent=l))}var l,i;f(this)}),n(document).on("ajaxError",".js-marketplace-listing-form",function(e,t){t.responseJSON&&t.responseJSON.error&&(e.preventDefault(),g(this,t.responseJSON.error))}),n(document).on("ajaxSend",".js-marketplace-listing-screenshot-resequence-form",function(){p(this)}),n(document).on("ajaxSuccess",".js-marketplace-listing-screenshot-resequence-form",function(){a(this.parentElement,HTMLElement).removeAttribute("data-old-index")}),n(document).on("ajaxError",".js-marketplace-listing-screenshot-resequence-form",function(e){var t=a(this.parentElement,HTMLElement),n=parseInt(t.getAttribute("data-old-index"),10),r=a(t.parentElement,HTMLElement);r.removeChild(t),r.children[n]?r.insertBefore(t,r.children[n]):r.appendChild(t),e.preventDefault(),g(this,"Error updating screenshot sequence, please try again later.")}),n(document).on("ajaxSuccess",".js-marketplace-listing-screenshot-update-form",function(){var t=e.query(this,".js-marketplace-listing-screenshot-caption-field",HTMLInputElement),n=e.query(this,".js-marketplace-listing-screenshot-caption-present"),r=e.query(this,".js-marketplace-listing-screenshot-caption-empty");n.textContent=t.value,t.value.trim().length<1?(n.classList.add("d-none"),r.classList.remove("d-none")):(n.classList.remove("d-none"),r.classList.add("d-none")),f(this)}),n(document).on("ajaxError",".js-marketplace-listing-screenshot-update-form",function(e){var t;e.preventDefault(),(t=this.querySelector(".js-marketplace-listing-save-error"))&&(t.classList.add("visible"),setTimeout(function(){return t.classList.remove("visible")},1500))}),n(document).on("ajaxSend",".js-marketplace-listing-screenshot-delete-form",function(){p(this),e.query(this,".js-marketplace-listing-screenshot-delete-button",HTMLButtonElement).disabled=!0}),n(document).on("ajaxError",".js-marketplace-listing-screenshot-delete-form",function(t,n){n.responseJSON&&n.responseJSON.error&&(t.preventDefault(),g(this,n.responseJSON.error)),e.query(this,".js-marketplace-listing-screenshot-delete-button",HTMLButtonElement).disabled=!1}),n(document).on("ajaxSuccess",".js-marketplace-listing-screenshot-delete-form",function(){e.closest(this,".js-marketplace-listing-screenshot-container").remove()}),c.onInput("textarea.js-listing-characters-remaining-field",function(e){var t=a(e.target,HTMLTextAreaElement),n=parseInt(t.getAttribute("data-character-limit"),10);j(t.value,n,t)}),c.onInput("input.js-listing-characters-remaining-field",function(e){var t=a(e.target,HTMLInputElement),n=t.maxLength;j(t.value,n,t)}),t.on("menu:deactivate",".js-edit-marketplace-listing-supported-languages .js-select-menu",function(){var t,n,r,l=a(this,HTMLElement),i=(l.getAttribute("data-supported-language-names")||"").split(","),o=m(l),c=e.closest(l,"form",HTMLFormElement);if(t=o,n=i.sort(),r=t.sort(),!(n.length===r.length&&n.every(function(e,t){return e===r[t]}))){if(0===o.length)e.query(l,".js-no-selected-languages",HTMLInputElement).checked=!0;s.fetchJSON(c.action,{method:c.method,body:new FormData(c)}).then(function(){l.setAttribute("data-supported-language-names",o.toString()),f(c)}).catch(function(){g(c,"Something went wrong")})}}),o.observe(".js-draggable-screenshots-container",function(e){r.create(e,{animation:150,draggable:".js-draggable-screenshot",onUpdate:y})}),t.on("change","select.js-marketplace-edit-price-model",function(){var t=a(this,HTMLSelectElement),n=t.options[t.selectedIndex],r=e.closest(t,".js-marketplace-edit-plan-editor"),s=n.value,l=String(n.getAttribute("data-note")),i=e.query(r,".js-marketplace-plan-edit-unit-note");r.setAttribute("data-model",s),i.textContent=l;var o=String(t.getAttribute("data-related-input"));e.query(r,o,HTMLInputElement).required=n.hasAttribute("data-related-input-required")}),t.on("click",".js-marketplace-plan-preview-toggle",function(){var t=this.closest(".js-marketplace-edit-plan-container"),n=e.query(t,".js-marketplace-plan-editor-toggle"),r=e.query(t,".js-marketplace-edit-plan-editor"),a=e.query(t,".js-marketplace-edit-plan-preview");a.classList.contains("d-none")&&(this.classList.add("selected"),n.classList.remove("selected"),a.classList.remove("d-none"),r.classList.add("d-none"),function(t,n){var r=e.query(n,".js-marketplace-plan-name"),a=e.query(t,".js-marketplace-plan-name-field",HTMLInputElement).value;r.textContent=a;var s=e.query(n,".js-marketplace-free-trial-container"),l=e.query(n,".js-marketplace-no-trial-container");e.query(t,".js-marketplace-free-trial-field",HTMLInputElement).checked?(s.classList.remove("d-none"),l.classList.add("d-none")):(l.classList.remove("d-none"),s.classList.add("d-none"));var i=e.query(t,".js-marketplace-edit-price-model",HTMLSelectElement).value,o=n.querySelectorAll(".js-marketplace-plan-unit-name"),c=e.query(n,".js-marketplace-plan-per-unit-info");if("PER_UNIT"===i){var u=e.query(t,".js-marketplace-plan-unit-name-field",HTMLInputElement).value,d=!0,m=!1,p=void 0;try{for(var g,f=o[Symbol.iterator]();!(d=(g=f.next()).done);d=!0){var h=g.value;h.textContent=u,h.classList.remove("d-none")}}catch(e){m=!0,p=e}finally{try{!d&&f.return&&f.return()}finally{if(m)throw p}}c.classList.remove("d-none")}else{var v=!0,j=!1,y=void 0;try{for(var k,L=o[Symbol.iterator]();!(v=(k=L.next()).done);v=!0)k.value.classList.add("d-none")}catch(e){j=!0,y=e}finally{try{!v&&L.return&&L.return()}finally{if(j)throw y}}c.classList.add("d-none")}if("FREE"===i){var b=n.querySelectorAll(".js-marketplace-plan-dollars-container"),q=!0,x=!1,E=void 0;try{for(var S,T=b[Symbol.iterator]();!(q=(S=T.next()).done);q=!0)S.value.classList.add("d-none")}catch(e){x=!0,E=e}finally{try{!q&&T.return&&T.return()}finally{if(x)throw E}}}else{var M=e.query(n,".js-marketplace-plan-monthly-dollars"),H=e.query(t,".js-marketplace-plan-monthly-price-field",HTMLInputElement).value;M.textContent=H,e.closest(M,".js-marketplace-plan-dollars-container").classList.remove("d-none");var w=e.query(n,".js-marketplace-plan-yearly-dollars"),I=e.query(t,".js-marketplace-plan-yearly-price-field",HTMLInputElement).value;w.textContent=I,e.closest(w,".js-marketplace-plan-dollars-container").classList.remove("d-none")}var A=e.query(n,".js-marketplace-plan-bullets");A.innerHTML="";var C=e.querySelectorAll(t,".js-marketplace-plan-bullet-field",HTMLInputElement),O=e.query(n,".js-marketplace-plan-bullet-template",HTMLTemplateElement),N=!0,J=!1,P=void 0;try{for(var D,F=C[Symbol.iterator]();!(N=(D=F.next()).done);N=!0){var B=D.value.value;if(!(B.trim().length<1)){var U=O.content.cloneNode(!0);e.query(U,".js-marketplace-plan-bullet").textContent=B,A.appendChild(U)}}}catch(e){J=!0,P=e}finally{try{!N&&F.return&&F.return()}finally{if(J)throw P}}var _=e.query(n,".js-marketplace-plan-description"),R=e.query(t,".js-marketplace-plan-description-field",HTMLInputElement).value;_.textContent=R}(r,a))}),t.on("click",".js-marketplace-plan-editor-toggle",function(){var t=this.closest(".js-marketplace-edit-plan-container"),n=e.query(t,".js-marketplace-plan-preview-toggle"),r=e.query(t,".js-marketplace-edit-plan-editor"),a=e.query(t,".js-marketplace-edit-plan-preview");r.classList.contains("d-none")&&(this.classList.add("selected"),n.classList.remove("selected"),a.classList.add("d-none"),r.classList.remove("d-none"))}),t.on("change",".js-marketplace-plan-dollar-field",function(){var t=a(this,HTMLInputElement);e.closest(t,".js-marketplace-plan-dollar-field-container").classList.toggle("is-errored",!t.checkValidity())}),t.on("change",".js-marketplace-insights-period",function(e){var t=e.target.getAttribute("data-url");i(t,"null.js:8");var n=document.getElementById("js-pjax-container");i(n,"null.js:10"),d({url:t,container:n})}),c.onInput(".js-marketplace-order-quantity",function(t){var n=a(t.target,HTMLInputElement),r=parseInt(n.value,10).toFixed(),l=n.getAttribute("data-url");i(l,"`data-url` must exist -- null.js:17");var o=new URL(l,window.location.origin),c=new URLSearchParams(o.search.slice(1));c.set("quantity",r),o.search=c.toString(),s.fetchSafeDocumentFragment(document,o).then(function(t){var n=e.query(document,".js-marketplace-order-preview");n.innerHTML="",n.appendChild(t)})}),t.on("change",".js-grant-oap-checkbox",function(){var t=e.query(document,".js-marketplace-complete-order",HTMLButtonElement);t&&(t.disabled=!this.checked)})});
